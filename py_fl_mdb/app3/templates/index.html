<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .container {
            margin: 0 auto;
            width: 100vw;
            padding: 0;
        }

        .head {
            background-color: #6610f2;
            color: #ffffff;
            width: 100%;
            padding: 50px 30px 10px 30px;
            margin-bottom: 20px;
        }

        .btn-primary {
            background-color: #6610f2;
            border-color: #6610f2;
        }

        .btn-primary:hover {
            background-color: #5a0fcf;
            border-color: #5a0fcf;
        }

        .form-control {
            border-color: #6610f2;
        }

        .form-control:focus {
            border-color: #5a0fcf;
            box-shadow: 0 0 0 0.25rem rgba(103, 58, 183, 0.25);
        }

        .field {
            border: 0;
            background-color: transparent;
        }

        .update {
            background-color: #ff7f0e;
            color: #ffffff;
        }

        .active {
            background-color: #6610f2;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="head">
            <h1 class="display-4">User Management Dashboard</h1>
            <p class="lead">Welcome to the user management dashboard. Manage your users efficiently.</p>
        </div>

        <!-- Add User Section -->
        <section id="add-user">
            <h2>Add User</h2>
            <form action="/add_user" method="POST">
                <div class="mb-3 col-6">
                    <input type="text" class="form-control" name="name" placeholder="Name" required>
                </div>
                <div class="mb-3 col-6">
                    <input type="number" class="form-control " name="age" placeholder="Age" required>
                </div>
                <button type="submit" class="btn btn-primary">Add User</button>

            </form>
        </section>
        <hr>
        <!-- Existing Users Section -->
        <section id="existing-users">
            <h2>Existing Users</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr id="{{ user._id }}_row">
                        <td>
                            <form action="/modify_user/{{ user._id }}" method="POST">
                                <div class="mb-3">
                                    <input type="text" class="form-control field" name="name" placeholder="New Name"
                                        value="{{ user.name }}" id="{{ user._id }}_mod_name" readonly>
                                </div>
                        </td>
                        <td>
                            <div class="mb-3">
                                <input type="number" class="form-control field" name="age" placeholder="New Age"
                                    value="{{ user.age }}" id="{{ user._id }}_mod_age" readonly>
                            </div>
                        </td>
                        <td>
                            <div class="mb-1">
                                <a class="btn btn-primary" onclick="toggleEdit('{{ user._id }}')">Modify</a>
                                <button type="submit" class="btn update">Update</button>
                                </form>
                            </div>
                        </td>
                        <td>
                            <div class="mb-3">
                                <form action="/delete_user/{{ user._id }}" method="POST">
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </form>
                            </div>

                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </section>
    </div>

    <!-- Bootstrap and Popper.js scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script>
        let activeFields = null;

        function toggleEdit(userId) {
            let inputField = document.getElementById(userId + "_mod_name");
            let inputField2 = document.getElementById(userId + "_mod_age");
            let row = document.getElementById(userId + "_row");

            // Deactivate previously active fields and remove active class
            if (activeFields) {
                activeFields.name.readOnly = true;
                activeFields.age.readOnly = true;
                activeFields.row.classList.remove("active");

                // Revert styling changes for previously active fields
                activeFields.name.style.backgroundColor = "transparent";
                activeFields.name.style.border = "0";
                activeFields.age.style.backgroundColor = "transparent";
                activeFields.age.style.border = "0";
            }

            // Activate fields in the clicked row
            inputField.readOnly = !inputField.readOnly;
            inputField2.readOnly = !inputField2.readOnly;
            row.classList.add("active");

            // Apply styling changes based on read-only status
            if (inputField.readOnly) {
                inputField.style.backgroundColor = "transparent";
                inputField.style.border = "0";
            } else {
                inputField.style.backgroundColor = "white";
                inputField.style.border = "1px solid red";
            }

            if (inputField2.readOnly) {
                inputField2.style.backgroundColor = "transparent";
                inputField2.style.border = "0";
            } else {
                inputField2.style.backgroundColor = "white";
                inputField2.style.border = "1px solid red";
            }

            // Update active fields
            activeFields = {
                name: inputField,
                age: inputField2,
                row: row
            };
        }


    </script>

</body>

</html>